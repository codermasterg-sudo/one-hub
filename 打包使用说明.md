
## æ¦‚è¿°

`package-prod.sh` è„šæœ¬ç”¨äºå°†ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ‰€éœ€çš„æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæ–¹ä¾¿åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šå¿«é€Ÿéƒ¨ç½²ã€‚

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Make å‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒ
make -f Makefile.prod package

# æŸ¥çœ‹æ‰“åŒ…æ–‡ä»¶ä¿¡æ¯
make -f Makefile.prod package-check

# æŸ¥çœ‹æ‰“åŒ…å†…å®¹ï¼ˆä¸è§£å‹ï¼‰
make -f Makefile.prod package-extract FILE=dist/one-hub-prod-xxx.tar.gz

# æ¸…ç†æ‰“åŒ…æ–‡ä»¶
make -f Makefile.prod package-clean
```

### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œè„šæœ¬

```bash
bash scripts/package-prod.sh
```

---

## ğŸ“‹ æ‰“åŒ…å†…å®¹

### æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰

- `Makefile.prod` - ç”Ÿäº§ç¯å¢ƒ Make ç®¡ç†å·¥å…·
- `docker-compose.prod.yml` - Docker Compose é…ç½®

### è„šæœ¬æ–‡ä»¶

- `scripts/backup.sh` - æ•°æ®åº“å¤‡ä»½è„šæœ¬
- `scripts/restore.sh` - æ•°æ®åº“æ¢å¤è„šæœ¬
- `scripts/quick-start.sh` - ä¸€é”®éƒ¨ç½²è„šæœ¬
- `scripts/check-env.sh` - ç¯å¢ƒæ£€æŸ¥è„šæœ¬ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

### é…ç½®æ–‡ä»¶

- `.env.production.example` - ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
- `config.example.yaml` - é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆå¦‚å­˜åœ¨ï¼‰

### æ–‡æ¡£æ–‡ä»¶

- `README.md` - é¡¹ç›®è¯´æ˜
- `DEPLOY.md` - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
- `PRODUCTION.md` - ç”Ÿäº§ç¯å¢ƒæŒ‡å—
- `å®‰å…¨ä¿®å¤è¯´æ˜.md` - å®‰å…¨ç›¸å…³è¯´æ˜
- `MANIFEST.txt` - éƒ¨ç½²åŒ…æ¸…å•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- `å¿«é€Ÿå¼€å§‹.txt` - å¿«é€Ÿéƒ¨ç½²æŒ‡å—ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- `README-DEPLOY.md` - éƒ¨ç½²åŒ…è¯´æ˜ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

### ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ mysql/      # MySQL æ•°æ®ç›®å½•
â”œâ”€â”€ redis/      # Redis æ•°æ®ç›®å½•
â””â”€â”€ app/        # åº”ç”¨æ•°æ®ç›®å½•
logs/           # æ—¥å¿—ç›®å½•
backups/        # å¤‡ä»½ç›®å½•
```

### å…¶ä»–æ–‡ä»¶

- `.gitignore` - Git å¿½ç•¥è§„åˆ™ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- `bin/generate_random_key.sh` - å¯†é’¥ç”Ÿæˆè„šæœ¬ï¼ˆå¦‚å­˜åœ¨ï¼‰

---

## ğŸ”§ æ‰“åŒ…é€‰é¡¹

è„šæœ¬è¿è¡Œæ—¶ä¼šè¯¢é—®ä»¥ä¸‹é€‰é¡¹ï¼š

### 1. æ˜¯å¦åŒ…å«ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Ÿ

```
æ˜¯å¦åŒ…å«ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Ÿ(y/n) [y]:
```

- **y**: åŒ…å« `.env.production.example` å’Œ `config.example.yaml`
- **n**: ä¸åŒ…å«é…ç½®ç¤ºä¾‹

### 2. æ˜¯å¦åŒ…å«éƒ¨ç½²æ–‡æ¡£ï¼Ÿ

```
æ˜¯å¦åŒ…å«éƒ¨ç½²æ–‡æ¡£ï¼Ÿ(y/n) [y]:
```

- **y**: åŒ…å«æ‰€æœ‰ `.md` æ–‡æ¡£
- **n**: ä¸åŒ…å«æ–‡æ¡£ï¼ˆä¸æ¨èï¼‰

### 3. é€‰æ‹©æ‰“åŒ…æ¨¡å¼

```
é€‰æ‹©æ‰“åŒ…æ¨¡å¼:
  1) å®Œæ•´æ‰“åŒ…ï¼ˆåŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼‰
  2) æœ€å°æ‰“åŒ…ï¼ˆä»…æ ¸å¿ƒæ–‡ä»¶ï¼‰
  3) è‡ªå®šä¹‰æ‰“åŒ…
```

- **æ¨¡å¼ 1ï¼ˆå®Œæ•´ï¼‰**: åŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ bin ç›®å½•ã€Nginx é…ç½®ç­‰
- **æ¨¡å¼ 2ï¼ˆæœ€å°ï¼‰**: ä»…åŒ…å«æ ¸å¿ƒæ–‡ä»¶ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½²
- **æ¨¡å¼ 3ï¼ˆè‡ªå®šä¹‰ï¼‰**: é¢„ç•™é€‰é¡¹ï¼Œå½“å‰ä¸å®Œæ•´æ¨¡å¼ç›¸åŒ

---

## ğŸ“‚ æ‰“åŒ…è¾“å‡º

### è¾“å‡ºç›®å½•ç»“æ„

```
dist/
â”œâ”€â”€ one-hub-prod-v1.0.0/        # è§£å‹åçš„ç›®å½•
â”‚   â”œâ”€â”€ Makefile.prod
â”‚   â”œâ”€â”€ docker-compose.prod.yml
â”‚   â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ backups/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ one-hub-prod-v1.0.0.tar.gz  # å‹ç¼©åŒ…
â””â”€â”€ one-hub-prod-v1.0.0.tar.gz.md5  # MD5 æ ¡éªŒæ–‡ä»¶
```

### æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `*.tar.gz` | ä¸»å‹ç¼©åŒ… |
| `*.tar.gz.md5` | MD5 æ ¡éªŒæ–‡ä»¶ |
| `MANIFEST.txt` | éƒ¨ç½²åŒ…æ¸…å•ï¼ˆåœ¨å‹ç¼©åŒ…å†…ï¼‰ |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ä¸€ï¼šæœ¬åœ°æ‰“åŒ…ï¼ŒæœåŠ¡å™¨éƒ¨ç½²

```bash
# 1. åœ¨æœ¬åœ°æ‰“åŒ…
make -f Makefile.prod package

# 2. ä¼ è¾“åˆ°æœåŠ¡å™¨
scp dist/one-hub-prod-*.tar.gz user@server:/path/

# 3. åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
ssh user@server
cd /path/
tar -xzf one-hub-prod-*.tar.gz
cd one-hub-prod-*/

# 4. å¼€å§‹éƒ¨ç½²
bash scripts/quick-start.sh
```

### åœºæ™¯äºŒï¼šå¤šæœåŠ¡å™¨æ‰¹é‡éƒ¨ç½²

```bash
# 1. æ‰“åŒ…ä¸€æ¬¡
make -f Makefile.prod package

# 2. æ‰¹é‡ä¼ è¾“
for server in server1 server2 server3; do
    scp dist/one-hub-prod-*.tar.gz user@$server:/opt/
done

# 3. æ‰¹é‡éƒ¨ç½²ï¼ˆAnsible ç¤ºä¾‹ï¼‰
ansible all -m copy -a "src=dist/one-hub-prod-*.tar.gz dest=/opt/"
ansible all -m shell -a "cd /opt && tar -xzf one-hub-prod-*.tar.gz"
```

### åœºæ™¯ä¸‰ï¼šç¦»çº¿éƒ¨ç½²

```bash
# 1. åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šæ‰“åŒ…
make -f Makefile.prod package

# 2. åŒæ—¶æ‹‰å– Docker é•œåƒ
docker pull martialbe/one-api:latest
docker pull mysql:8.2
docker pull redis:7-alpine

# 3. å¯¼å‡ºé•œåƒ
docker save martialbe/one-api:latest -o one-api.tar
docker save mysql:8.2 -o mysql.tar
docker save redis:7-alpine -o redis.tar

# 4. ä¼ è¾“æ‰€æœ‰æ–‡ä»¶åˆ°ç¦»çº¿æœåŠ¡å™¨
scp dist/*.tar.gz *.tar user@offline-server:/opt/

# 5. åœ¨ç¦»çº¿æœåŠ¡å™¨ä¸Šå¯¼å…¥é•œåƒ
docker load -i one-api.tar
docker load -i mysql.tar
docker load -i redis.tar

# 6. è§£å‹éƒ¨ç½²åŒ…å¹¶éƒ¨ç½²
tar -xzf one-hub-prod-*.tar.gz
cd one-hub-prod-*/
bash scripts/quick-start.sh
```

---

## ğŸ” æ ¡éªŒæ‰“åŒ…æ–‡ä»¶

### éªŒè¯ MD5

```bash
# åœ¨æºæœºå™¨ä¸Š
cd dist/
md5sum one-hub-prod-*.tar.gz

# ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨å
md5sum -c one-hub-prod-*.tar.gz.md5
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
one-hub-prod-v1.0.0.tar.gz: OK
```

### æŸ¥çœ‹æ‰“åŒ…å†…å®¹

```bash
# åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
tar -tzf dist/one-hub-prod-*.tar.gz

# ä»…æŸ¥çœ‹ç›®å½•ç»“æ„
tar -tzf dist/one-hub-prod-*.tar.gz | grep '/$'

# æŸ¥çœ‹ MANIFEST æ–‡ä»¶
tar -xzf dist/one-hub-prod-*.tar.gz --to-stdout one-hub-prod-*/MANIFEST.txt
```

---

## ğŸ“¦ æ‰“åŒ…ç¤ºä¾‹è¾“å‡º

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          One Hub ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å·¥å…·                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

>>> æ‰“åŒ…é…ç½®

æ˜¯å¦åŒ…å«ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Ÿ(y/n) [y]: y
æ˜¯å¦åŒ…å«éƒ¨ç½²æ–‡æ¡£ï¼Ÿ(y/n) [y]: y

é€‰æ‹©æ‰“åŒ…æ¨¡å¼:
  1) å®Œæ•´æ‰“åŒ…ï¼ˆåŒ…å«æ‰€æœ‰æ–‡ä»¶ï¼‰
  2) æœ€å°æ‰“åŒ…ï¼ˆä»…æ ¸å¿ƒæ–‡ä»¶ï¼‰
  3) è‡ªå®šä¹‰æ‰“åŒ…
è¯·é€‰æ‹© (1/2/3) [1]: 1

>>> å¼€å§‹æ‰“åŒ…...
>>> æ‰“åŒ…æ ¸å¿ƒæ–‡ä»¶...
  âœ“ Makefile.prod
  âœ“ docker-compose.prod.yml
>>> æ‰“åŒ…è„šæœ¬æ–‡ä»¶...
  âœ“ scripts/backup.sh
  âœ“ scripts/restore.sh
  âœ“ scripts/quick-start.sh
>>> æ‰“åŒ…é…ç½®æ–‡ä»¶ç¤ºä¾‹...
  âœ“ .env.production.example
>>> æ‰“åŒ…æ–‡æ¡£æ–‡ä»¶...
  âœ“ README.md
  âœ“ DEPLOY.md
  âœ“ PRODUCTION.md
>>> åˆ›å»ºç›®å½•ç»“æ„...
  âœ“ data/mysql/
  âœ“ data/redis/
  âœ“ data/app/
  âœ“ logs/
  âœ“ backups/
>>> ç”Ÿæˆéƒ¨ç½²æ¸…å•...
  âœ“ MANIFEST.txt
>>> ç”Ÿæˆå¿«é€Ÿå¼€å§‹æ–‡æ¡£...
  âœ“ å¿«é€Ÿå¼€å§‹.txt
>>> ç”Ÿæˆ .gitignore...
  âœ“ .gitignore
>>> ç”Ÿæˆéƒ¨ç½²åŒ… README...
  âœ“ README-DEPLOY.md
>>> åˆ›å»ºç¯å¢ƒæ£€æŸ¥è„šæœ¬...
  âœ“ scripts/check-env.sh

>>> å‹ç¼©æ‰“åŒ…...
âœ“ æ‰“åŒ…å®Œæˆ

>>> ç”Ÿæˆæ ¡éªŒæ–‡ä»¶...
  âœ“ one-hub-prod-v1.0.0.tar.gz.md5

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   æ‰“åŒ…å®Œæˆï¼                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ‰“åŒ…ä¿¡æ¯:
  æ–‡ä»¶å: ./dist/one-hub-prod-v1.0.0.tar.gz
  å¤§å°: 128K
  MD5: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6

åŒ…å«å†…å®¹:
  æ–‡ä»¶æ•°: 25
  ç›®å½•æ•°: 8

ä½¿ç”¨æ–¹æ³•:
  1. ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨:
     scp ./dist/one-hub-prod-v1.0.0.tar.gz user@server:/path/

  2. åœ¨æœåŠ¡å™¨ä¸Šè§£å‹:
     tar -xzf one-hub-prod-v1.0.0.tar.gz
     cd one-hub-prod-v1.0.0

  3. å¼€å§‹éƒ¨ç½²:
     bash scripts/quick-start.sh
     æˆ–
     make -f Makefile.prod init

æ ¡éªŒ MD5:
  md5sum -c one-hub-prod-v1.0.0.tar.gz.md5

æŸ¥çœ‹æ¸…å•:
  tar -tzf ./dist/one-hub-prod-v1.0.0.tar.gz | head -20

æ˜¯å¦æŸ¥çœ‹æ‰“åŒ…å†…å®¹ï¼Ÿ(y/n) [n]:
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¸ä¼šæ‰“åŒ…çš„å†…å®¹

ä»¥ä¸‹å†…å®¹**ä¸ä¼š**è¢«æ‰“åŒ…ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰ï¼š

- âŒ `.env.production`ï¼ˆåŒ…å«å®é™…å¯†é’¥ï¼‰
- âŒ `data/` ç›®å½•ä¸­çš„å®é™…æ•°æ®
- âŒ `logs/` ç›®å½•ä¸­çš„æ—¥å¿—æ–‡ä»¶
- âŒ `backups/` ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶
- âŒ æºä»£ç ï¼ˆweb/, model/, controller/ ç­‰ï¼‰
- âŒ `.git/` ç›®å½•
- âŒ `node_modules/`

### å®‰å…¨å»ºè®®

1. **ä¸è¦æ‰“åŒ…æ•æ„Ÿä¿¡æ¯**ï¼šç¡®ä¿ä¸åŒ…å« `.env.production` ç­‰åŒ…å«å¯†é’¥çš„æ–‡ä»¶
2. **éªŒè¯æ‰“åŒ…å†…å®¹**ï¼šæ‰“åŒ…åæ£€æŸ¥æ˜¯å¦åŒ…å«ä¸åº”è¯¥æ‰“åŒ…çš„æ–‡ä»¶
3. **å®‰å…¨ä¼ è¾“**ï¼šä½¿ç”¨ SCPã€SFTP ç­‰åŠ å¯†æ–¹å¼ä¼ è¾“
4. **åŠæ—¶æ¸…ç†**ï¼šéƒ¨ç½²å®ŒæˆååŠæ—¶åˆ é™¤æœåŠ¡å™¨ä¸Šçš„å‹ç¼©åŒ…

---

## ğŸ”§ è‡ªå®šä¹‰æ‰“åŒ…

å¦‚éœ€è‡ªå®šä¹‰æ‰“åŒ…å†…å®¹ï¼Œå¯ä»¥ä¿®æ”¹ `scripts/package-prod.sh`ï¼š

### æ·»åŠ æ–‡ä»¶

```bash
# åœ¨è„šæœ¬ä¸­æ‰¾åˆ°ç›¸åº”éƒ¨åˆ†ï¼Œæ·»åŠ æ–‡ä»¶
core_files=(
    "Makefile.prod"
    "docker-compose.prod.yml"
    "your-custom-file.txt"  # æ·»åŠ è‡ªå®šä¹‰æ–‡ä»¶
)
```

### æ·»åŠ ç›®å½•

```bash
# å¤åˆ¶æ•´ä¸ªç›®å½•
cp -r custom-dir "$PACKAGE_DIR/"
```

### æ’é™¤æ–‡ä»¶

```bash
# ä½¿ç”¨ tar çš„ --exclude é€‰é¡¹
tar -czf "${PACKAGE_NAME}.tar.gz" \
    --exclude="*.tmp" \
    --exclude=".git" \
    "$PACKAGE_NAME"
```

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ‰“åŒ…å¤±è´¥

```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la scripts/package-prod.sh

# æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬æŸ¥çœ‹è¯¦ç»†é”™è¯¯
bash -x scripts/package-prod.sh
```

### é—®é¢˜ï¼šMD5 æ ¡éªŒå¤±è´¥

```bash
# é‡æ–°ä¸‹è½½å‹ç¼©åŒ…
# æˆ–é‡æ–°æ‰“åŒ…

# æ¯”è¾ƒæ–‡ä»¶å¤§å°
ls -lh original.tar.gz downloaded.tar.gz
```

### é—®é¢˜ï¼šè§£å‹å¤±è´¥

```bash
# æ£€æŸ¥å‹ç¼©åŒ…å®Œæ•´æ€§
tar -tzf one-hub-prod-*.tar.gz >/dev/null

# ä½¿ç”¨ verbose æ¨¡å¼è§£å‹
tar -xzvf one-hub-prod-*.tar.gz
```

---

## ğŸ“š ç›¸å…³å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰æ‰“åŒ…ç›¸å…³å‘½ä»¤
make -f Makefile.prod help | grep -A 5 "æ‰“åŒ…å’Œåˆ†å‘"

# æ‰“åŒ…
make -f Makefile.prod package

# æ£€æŸ¥æ‰“åŒ…æ–‡ä»¶
make -f Makefile.prod package-check

# æŸ¥çœ‹æ‰“åŒ…å†…å®¹
make -f Makefile.prod package-extract FILE=dist/xxx.tar.gz

# æ¸…ç†æ‰“åŒ…æ–‡ä»¶
make -f Makefile.prod package-clean
```

---

**æ‰“åŒ…è„šæœ¬å·²å°±ç»ªï¼Œç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰
