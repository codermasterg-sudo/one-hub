# One Hub 生产环境配置示例
# 复制此文件为 .env.production 并修改相应配置

# ============================================
# 基础配置
# ============================================
TZ=Asia/Shanghai
GIN_MODE=release
LOG_LEVEL=info
PORT=3000

# ============================================
# 安全配置（必须修改！）
# ============================================
# 会话密钥（32位以上随机字符串）
# 生成命令: openssl rand -base64 32
SESSION_SECRET=CHANGE_ME_SESSION_SECRET

# 用户令牌密钥（32位以上随机字符串，设置后不可修改！）
# 生成命令: openssl rand -base64 32
USER_TOKEN_SECRET=CHANGE_ME_USER_TOKEN_SECRET

# Hashids Salt（可选，建议设置）
HASHIDS_SALT=

# ============================================
# 数据库配置
# ============================================
# MySQL root 密码
# 生成命令: openssl rand -base64 32
MYSQL_ROOT_PASSWORD=CHANGE_ME_MYSQL_ROOT_PASSWORD

# MySQL 应用用户密码
# 生成命令: openssl rand -base64 32
MYSQL_PASSWORD=CHANGE_ME_MYSQL_PASSWORD

# 数据库连接字符串（自动生成，无需修改）
SQL_DSN=oneapi:CHANGE_ME_MYSQL_PASSWORD@tcp(mysql:3306)/one-api

# 数据库连接池配置
SQL_MAX_IDLE_CONNS=100
SQL_MAX_OPEN_CONNS=1000
SQL_CONN_MAX_LIFETIME=60

# ============================================
# Redis 配置
# ============================================
REDIS_CONN_STRING=redis://redis:6379
REDIS_DB=0

# ============================================
# 性能优化配置
# ============================================
# 启用内存缓存（会导致5-10秒延迟）
MEMORY_CACHE_ENABLED=true
# 缓存同步频率（秒）
SYNC_FREQUENCY=300

# 启用批量更新（降低数据库写入压力）
BATCH_UPDATE_ENABLED=true
# 批量更新间隔（秒）
BATCH_UPDATE_INTERVAL=5

# 禁用 Token 编码器（可减少 40MB 内存，但影响 Token 计算精度）
DISABLE_TOKEN_ENCODERS=false

# Token 编码器缓存目录（离线环境需要）
TIKTOKEN_CACHE_DIR=

# ============================================
# 限流配置
# ============================================
# 全局 API 限流（单 IP 3分钟最大请求数）
GLOBAL_API_RATE_LIMIT=180
# 全局 Web 限流（单 IP 3分钟最大请求数）
GLOBAL_WEB_RATE_LIMIT=100

# 中继请求超时（秒）
RELAY_TIMEOUT=120
# 连接超时（秒）
CONNECT_TIMEOUT=5

# ============================================
# 渠道管理配置
# ============================================
# 渠道测试频率（分钟，0表示不自动测试）
CHANNEL_TEST_FREQUENCY=60
# 渠道余额更新频率（分钟，0表示不自动更新）
CHANNEL_UPDATE_FREQUENCY=1440
# 批量操作请求间隔（秒，避免触发 API 限流）
POLLING_INTERVAL=2

# ============================================
# 价格管理配置
# ============================================
# 启用价格自动更新
AUTO_PRICE_UPDATES=true
# 价格更新模式: system|add|update|overwrite
# system: 仅启动时使用内置价格初始化（推荐）
# add: 仅新增系统不存在的价格
# update: 仅更新现有价格
# overwrite: 覆盖所有价格（危险！）
AUTO_PRICE_UPDATES_MODE=system
# 价格自动更新间隔（分钟，仅 add/update/overwrite 模式生效）
AUTO_PRICE_UPDATES_INTERVAL=1440
# 价格更新服务地址（可选）
UPDATE_PRICE_SERVICE=

# ============================================
# 高级配置
# ============================================
# 可信头部（Cloudflare: CF-Connecting-IP, GAE: X-Appengine-Remote-Addr）
TRUSTED_HEADER=

# 用户月账单功能（消耗资源，谨慎开启）
USER_INVOICE_MONTH=false

# 语言设置
LANGUAGE=zh_CN

# ============================================
# 监控配置（可选）
# ============================================
# Prometheus 监控
METRICS_USER=
METRICS_PASSWORD=

# Uptime Kuma
UPTIME_KUMA_ENABLE=false
UPTIME_KUMA_DOMAIN=
UPTIME_KUMA_STATUS_PAGE_NAME=
